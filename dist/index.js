!function(){function e(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,o)}"function"==typeof SuppressedError&&SuppressedError;var t=iina.core,n=iina.mpv,r=iina.utils,o=iina.overlay;function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"15px",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3e3;o.simpleMode(),o.setContent(`<p>${e}</p>`),o.setStyle(`p { color: ${n?"red":"green"}; font-size: ${t}; margin-top: 40px;}`),o.show(),setTimeout(function(){o.hide()},r)}function a(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.postMessage("ffmpeg-status-out",{status:t})}var s=iina.menu;iina.mpv;var l=iina.sidebar;l.loadFile("dist/ui/window/index.html"),l.onMessage("getEndTime",function(){var e=n.getNumber("time-pos");l.postMessage("endTime",{time:e}),t.pause()}),l.onMessage("processVideoClip",function(o){!function(o,s){var l,c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"original",f=arguments.length>5?arguments[5]:void 0,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"/opt/homebrew/bin/ffmpeg";(l=function(){var e,l,h,g,v,m;return function(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(b){switch(b.label){case 0:if(!r.fileInPath(d))return[3,5];i("Processing ...","18px"),b.label=1;case 1:return b.trys.push([1,3,,4]),a(f,!0),e=n.getString("path"),l=n.getString("filename"),h=e.substring(0,e.lastIndexOf("/")),l.slice(0,l.lastIndexOf(".")),g=p,"original"===p&&(g=l.split(".").pop()),[4,r.exec(d,[c&&"-hwaccel",c&&"videotoolbox","-i",e,"-ss",o,"-to",s,u&&"-vf",u&&"crop=w=ih*(9/16):h=ih:x=(iw-ow)/2:y=0,format=yuv420p",c&&"-c:v",c&&"h264_videotoolbox",c&&"-q:v",c&&"70",!c&&"-c:v",!c&&"libx264",!c&&"-crf",!c&&"23","-c:a","copy","-movflags","+faststart",`${h}/${name_no_ext}_clip.${g}`].filter(Boolean))];case 2:return 0===(v=b.sent().status)?(a(f,!1),i("Clip saved in "+n.getString("path").substring(0,n.getString("path").lastIndexOf("/")),"18px"),f.hide(),t.resume()):i(`FFmpeg error code ${v}`,"18px",!0),[3,4];case 3:return m=b.sent(),i(`An error occured: ${m}`,"18px",!0),[3,4];case 4:return[3,6];case 5:i("ffmpeg not found","18px",!0),b.label=6;case 6:return[2]}})},function(){var t=this,n=arguments;return new Promise(function(r,o){var i=l.apply(t,n);function a(t){e(i,r,o,a,s,"next",t)}function s(t){e(i,r,o,a,s,"throw",t)}a(void 0)})})()}(o.startPos,o.endPos,o.hwaccel,o.verticalCrop,o.format,l)}),l.onMessage("closeWindow",function(){l.hide()});var c=s.item("Start Clipping",function(){var e,t;l.show(),e=n.getNumber("time-pos"),l.postMessage("currentTime",{time:e}),(t=r.fileInPath("/opt/homebrew/bin/ffmpeg"))||(t=r.fileInPath("/usr/local/bin/ffmpeg")),l.postMessage("is-ffmpeg-installed",{isInstalled:t})},{keyBinding:"Alt+Shift+r"});s.addItem(c)}();
//# sourceMappingURL=index.js.map
