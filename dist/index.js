!function(){function e(e,t,r,n,i,o,a){try{var s=e[o](a),l=s.value}catch(e){r(e);return}s.done?t(l):Promise.resolve(l).then(n,i)}function t(t){return function(){var r=this,n=arguments;return new Promise(function(i,o){var a=t.apply(r,n);function s(t){e(a,i,o,s,l,"next",t)}function l(t){e(a,i,o,s,l,"throw",t)}s(void 0)})}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,n,i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var o=[],a=!0,s=!1;try{for(i=i.call(e);!(a=(r=i.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,n=e}finally{try{a||null==i.return||i.return()}finally{if(s)throw n}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var u=[s,l];if(r)throw TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&u[0]?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,n=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){o.label=u[1];break}if(6===u[0]&&o.label<i[1]){o.label=i[1],i=u;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(u);break}i[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],n=0}finally{r=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}}"function"==typeof SuppressedError&&SuppressedError;var o,a=iina.core,s=iina.mpv,l=iina.utils,u=iina.overlay,c=iina.event;function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"15px",r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3e3;u.simpleMode(),u.setContent(`<p>${e}</p>`),u.setStyle(`p { color: ${r?"red":"green"}; font-size: ${t}; margin-top: 40px;}`),u.show(),setTimeout(function(){u.hide()},n)}function f(e){var t=s.getNumber("time-pos");e.postMessage("currentTime",{time:t})}function d(e){var t=l.fileInPath("/opt/homebrew/bin/ffmpeg");t||(t=l.fileInPath("/usr/local/bin/ffmpeg")),e.postMessage("is-ffmpeg-installed",{isInstalled:t})}function h(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.postMessage("ffmpeg-status-out",{status:t})}var g=iina.menu;iina.mpv;var m=iina.sidebar;m.loadFile("dist/ui/window/index.html"),m.onMessage("ui-ready",function(){d(m),f(m)}),o=null,m.onMessage("previewClip",function(e){var t=e.start,r=e.end,i=n(t.split(":").map(Number),3),l=i[0],u=i[1],p=i[2],f=n(r.split(":").map(Number),3),d=3600*f[0]+60*f[1]+f[2];s.set("time-pos",3600*l+60*u+p),a.resume(),o&&(c.off("mpv.time-pos.changed",o),o=null),o=function(e){e>=d&&(a.pause(),c.off("mpv.time-pos.changed",o),o=null)},c.on("mpv.time-pos.changed",o)}),m.onMessage("getEndTime",function(){var e=s.getNumber("time-pos");m.postMessage("endTime",{time:e}),a.pause()}),m.onMessage("getStartTime",function(){var e=s.getNumber("time-pos");m.postMessage("startTime",{time:e}),a.pause()}),m.onMessage("processVideoClip",function(e){var r=e.clips,n=e.hwaccel,o=e.verticalCrop,u=e.cropMode,c=e.format;return t(function(){var e,f,d,g,v,b,y;return i(this,function(w){switch(w.label){case 0:e=!0,f=!1,d=void 0,w.label=1;case 1:w.trys.push([1,6,7,8]),g=r[Symbol.iterator](),w.label=2;case 2:if(e=(v=g.next()).done)return[3,5];if("COMPLETED"===(b=v.value).status)return[3,4];return m.postMessage("clip-status-update",{id:b.id,status:"PROCESSING"}),[4,function(e,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"default",c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"original",f=arguments.length>6?arguments[6]:void 0,d=arguments.length>7?arguments[7]:void 0,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"/opt/homebrew/bin/ffmpeg";return t(function(){var t,m,v,b,y,w,x,M,S,E,I,C;return i(this,function(i){if(t=!1,m=g,!l.fileInPath(m)&&l.fileInPath("/usr/local/bin/ffmpeg")&&(m="/usr/local/bin/ffmpeg"),l.fileInPath(m)){p(`Processing Clip ${d}...`,"18px");try{if(t=!0,h(f,t),v=s.getString("path"),b=s.getString("filename"),y=v.substring(0,v.lastIndexOf("/")),w=b.substring(0,b.lastIndexOf(".")),x="mov","mp4"===c&&(x="mp4"),"original"===c&&(x=b.split(".").pop()),M=e.replace(/:/g,"-"),S=null,E="crop=w=ih*(9/16):h=ih:x=(iw-ow)/2:y=0",o){switch(u){case"left-3":E="crop=iw/3:ih:0:0";break;case"center-3":E="crop=iw/3:ih:iw/3:0";break;case"right-3":E="crop=iw/3:ih:2*iw/3:0";break;case"left-2":E="crop=iw/2:ih:0:0";break;case"right-2":E="crop=iw/2:ih:iw/2:0"}E+=",format=yuv420p",S=E}else S="format=yuv420p";C=(I=function(t){var n=["-y","-ss",e,"-to",r,"-i",v,"-vf",S,t&&"-c:v",t&&"h264_videotoolbox",t&&"-q:v",t&&"70",!t&&"-c:v",!t&&"libx264",!t&&"-crf",!t&&"23","-c:a","copy","-movflags","+faststart",`${y}/${w}_clip_${M}.${x}`].filter(Boolean);return a.run(m,n)})(n),0!==C&&n&&(p(`HW Accel failed (Err ${C}). Retrying on CPU...`,"16px"),C=I(!1)),0===C?(t=!1,h(f,t),f.postMessage("clip-status-update",{id:d,status:"COMPLETED"}),p("Clip saved","18px")):(t=!1,h(f,t),f.postMessage("clip-status-update",{id:d,status:"ERROR"}),p(`Error: FFmpeg exited with code ${C}.`,"18px",!0,8e3))}catch(e){h(f,t=!1),f.postMessage("clip-status-update",{id:d,status:"ERROR"}),p(`Exception: ${e}`,"18px",!0,8e3)}}else f.postMessage("clip-status-update",{id:d,status:"ERROR"}),p("Error: ffmpeg binary not found.","18px",!0,8e3);return[2]})})()}(b.start,b.end,n,o,u,c,m,b.id)];case 3:w.sent(),w.label=4;case 4:return e=!0,[3,2];case 5:return[3,8];case 6:return y=w.sent(),f=!0,d=y,[3,8];case 7:try{e||null==g.return||g.return()}finally{if(f)throw d}return[7];case 8:return m.postMessage("batch-complete",{}),[2]}})})()}),m.onMessage("closeWindow",function(){m.hide()});var v=g.item("Start Clipping",function(){m.show(),f(m),d(m)},{keyBinding:"Alt+Shift+r"});g.addItem(v)}();
//# sourceMappingURL=index.js.map
