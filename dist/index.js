!function(){function e(e,t,n,r,i,s,a){try{var o=e[s](a),l=o.value}catch(e){n(e);return}o.done?t(l):Promise.resolve(l).then(r,i)}function t(t){return function(){var n=this,r=arguments;return new Promise(function(i,s){var a=t.apply(n,r);function o(t){e(a,i,s,o,l,"next",t)}function l(t){e(a,i,s,o,l,"throw",t)}o(void 0)})}}function n(e,t){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=o(0),a.throw=o(1),a.return=o(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(l){var u=[o,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&u[0]?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,r=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===u[0]||2===u[0])){s=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){s.label=u[1];break}if(6===u[0]&&s.label<i[1]){s.label=i[1],i=u;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(u);break}i[2]&&s.ops.pop(),s.trys.pop();continue}u=t.call(e,s)}catch(e){u=[6,e],r=0}finally{n=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}}"function"==typeof SuppressedError&&SuppressedError;var r=iina.core,i=iina.mpv,s=iina.utils,a=iina.overlay;function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"15px",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3e3;a.simpleMode(),a.setContent(`<p>${e}</p>`),a.setStyle(`p { color: ${n?"red":"green"}; font-size: ${t}; margin-top: 40px;}`),a.show(),setTimeout(function(){a.hide()},r)}function l(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.postMessage("ffmpeg-status-out",{status:t})}var u=iina.menu;iina.mpv;var c=iina.sidebar;c.loadFile("dist/ui/window/index.html"),c.onMessage("getEndTime",function(){var e=i.getNumber("time-pos");c.postMessage("endTime",{time:e}),r.pause()}),c.onMessage("getStartTime",function(){var e=i.getNumber("time-pos");c.postMessage("startTime",{time:e}),r.pause()}),c.onMessage("processVideoClip",function(e){var r=e.clips,a=e.hwaccel,u=e.verticalCrop,p=e.format;return t(function(){var e,f,d,g,h,v,m;return n(this,function(b){switch(b.label){case 0:e=!0,f=!1,d=void 0,b.label=1;case 1:b.trys.push([1,6,7,8]),g=r[Symbol.iterator](),b.label=2;case 2:if(e=(h=g.next()).done)return[3,5];if("COMPLETED"===(v=h.value).status)return[3,4];return c.postMessage("clip-status-update",{id:v.id,status:"PROCESSING"}),[4,function(e,r){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"original",p=arguments.length>5?arguments[5]:void 0,f=arguments.length>6?arguments[6]:void 0,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"/opt/homebrew/bin/ffmpeg";return t(function(){var t,g,h,v,m,b,y,w;return n(this,function(n){switch(n.label){case 0:if(!s.fileInPath(d))return[3,5];o(`Processing Clip ${f}...`,"18px"),n.label=1;case 1:return n.trys.push([1,3,,4]),l(p,!0),t=i.getString("path"),g=i.getString("filename"),h=t.substring(0,t.lastIndexOf("/")),v=g.slice(0,g.lastIndexOf(".")),m=c,"original"===c&&(m=g.split(".").pop()),b=e.replace(/:/g,"-"),[4,s.exec(d,[a&&"-hwaccel",a&&"videotoolbox","-i",t,"-ss",e,"-to",r,u&&"-vf",u&&"crop=w=ih*(9/16):h=ih:x=(iw-ow)/2:y=0,format=yuv420p",a&&"-c:v",a&&"h264_videotoolbox",a&&"-q:v",a&&"70",!a&&"-c:v",!a&&"libx264",!a&&"-crf",!a&&"23","-c:a","copy","-movflags","+faststart",`${h}/${v}_clip_${b}.${m}`].filter(Boolean))];case 2:return 0===(y=n.sent().status)?(l(p,!1),p.postMessage("clip-status-update",{id:f,status:"COMPLETED"}),o("Clip saved","18px")):(p.postMessage("clip-status-update",{id:f,status:"ERROR"}),o(`FFmpeg error code ${y}`,"18px",!0)),[3,4];case 3:return w=n.sent(),p.postMessage("clip-status-update",{id:f,status:"ERROR"}),o(`An error occured: ${w}`,"18px",!0),[3,4];case 4:return[3,6];case 5:p.postMessage("clip-status-update",{id:f,status:"ERROR"}),o("ffmpeg not found","18px",!0),n.label=6;case 6:return[2]}})})()}(v.start,v.end,a,u,p,c,v.id)];case 3:b.sent(),b.label=4;case 4:return e=!0,[3,2];case 5:return[3,8];case 6:return m=b.sent(),f=!0,d=m,[3,8];case 7:try{e||null==g.return||g.return()}finally{if(f)throw d}return[7];case 8:return c.postMessage("batch-complete",{}),[2]}})})()}),c.onMessage("closeWindow",function(){c.hide()});var p=u.item("Start Clipping",function(){var e,t;c.show(),e=i.getNumber("time-pos"),c.postMessage("currentTime",{time:e}),(t=s.fileInPath("/opt/homebrew/bin/ffmpeg"))||(t=s.fileInPath("/usr/local/bin/ffmpeg")),c.postMessage("is-ffmpeg-installed",{isInstalled:t})},{keyBinding:"Alt+Shift+r"});u.addItem(p)}();
//# sourceMappingURL=index.js.map
