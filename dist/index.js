!function(){function e(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function t(t){return function(){var r=this,n=arguments;return new Promise(function(i,a){var o=t.apply(r,n);function s(t){e(o,i,a,s,u,"next",t)}function u(t){e(o,i,a,s,u,"throw",t)}s(void 0)})}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,n,i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var a=[],o=!0,s=!1;try{for(i=i.call(e);!(o=(r=i.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,n=e}finally{try{o||null==i.return||i.return()}finally{if(s)throw n}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){var r,n,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){var l=[s,u];if(r)throw TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&l[0]?n.return:l[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,l[1])).done)return i;switch(n=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,n=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],n=0}finally{r=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}"function"==typeof SuppressedError&&SuppressedError;var a,o=iina.core,s=iina.mpv,u=iina.utils,l=iina.overlay,c=iina.event;function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"15px",r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3e3;l.simpleMode(),l.setContent(`<p>${e}</p>`),l.setStyle(`p { color: ${r?"red":"green"}; font-size: ${t}; margin-top: 40px;}`),l.show(),setTimeout(function(){l.hide()},n)}function f(e){var t=s.getNumber("time-pos");e.postMessage("currentTime",{time:t})}function d(e){var t=u.fileInPath("/opt/homebrew/bin/ffmpeg");t||(t=u.fileInPath("/usr/local/bin/ffmpeg")),e.postMessage("is-ffmpeg-installed",{isInstalled:t})}function h(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.postMessage("ffmpeg-status-out",{status:t})}var g=iina.menu;iina.mpv;var m=iina.sidebar;m.loadFile("dist/ui/window/index.html"),m.onMessage("ui-ready",function(){d(m),f(m)}),a=null,m.onMessage("previewClip",function(e){var t=e.start,r=e.end,i=n(t.split(":").map(Number),3),u=i[0],l=i[1],p=i[2],f=n(r.split(":").map(Number),3),d=3600*f[0]+60*f[1]+f[2];s.set("time-pos",3600*u+60*l+p),o.resume(),a&&(c.off("mpv.time-pos.changed",a),a=null),a=function(e){e>=d&&(o.pause(),c.off("mpv.time-pos.changed",a),a=null)},c.on("mpv.time-pos.changed",a)}),m.onMessage("getEndTime",function(){var e=s.getNumber("time-pos");m.postMessage("endTime",{time:e}),o.pause()}),m.onMessage("getStartTime",function(){var e=s.getNumber("time-pos");m.postMessage("startTime",{time:e}),o.pause()}),m.onMessage("processVideoClip",function(e){var r=e.clips,n=e.hwaccel,a=e.verticalCrop,o=e.cropMode,l=e.format;return t(function(){var e,c,f,d,g,v,b;return i(this,function(y){switch(y.label){case 0:e=!0,c=!1,f=void 0,y.label=1;case 1:y.trys.push([1,6,7,8]),d=r[Symbol.iterator](),y.label=2;case 2:if(e=(g=d.next()).done)return[3,5];if("COMPLETED"===(v=g.value).status)return[3,4];return m.postMessage("clip-status-update",{id:v.id,status:"PROCESSING"}),[4,function(e,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"default",l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"original",c=arguments.length>6?arguments[6]:void 0,f=arguments.length>7?arguments[7]:void 0,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"/opt/homebrew/bin/ffmpeg";return t(function(){var g,m,v,b,y,w,x,M,S,E,I,C;return i(this,function(O){switch(O.label){case 0:if(g=d,!u.fileInPath(g)&&u.fileInPath("/usr/local/bin/ffmpeg")&&(g="/usr/local/bin/ffmpeg"),!u.fileInPath(g))return[3,7];p(`Processing Clip ${f}...`,"18px"),O.label=1;case 1:if(O.trys.push([1,5,,6]),h(c,!0),m=s.getString("path"),v=s.getString("filename"),b=m.substring(0,m.lastIndexOf("/")),y=v.substring(0,v.lastIndexOf(".")),w="mov","mp4"===l&&(w="mp4"),"original"===l&&(w=v.split(".").pop()),x=e.replace(/:/g,"-"),M=null,S="crop=w=ih*(9/16):h=ih:x=(iw-ow)/2:y=0",a){switch(o){case"left-3":S="crop=iw/3:ih:0:0";break;case"center-3":S="crop=iw/3:ih:iw/3:0";break;case"right-3":S="crop=iw/3:ih:2*iw/3:0";break;case"left-2":S="crop=iw/2:ih:0:0";break;case"right-2":S="crop=iw/2:ih:iw/2:0"}S+=",format=yuv420p",M=S}else M="format=yuv420p";return[4,(E=function(n){return t(function(){var t;return i(this,function(i){switch(i.label){case 0:return t=["-y","-ss",e,"-to",r,"-i",m,"-vf",M,n&&"-c:v",n&&"h264_videotoolbox",n&&"-q:v",n&&"70",!n&&"-c:v",!n&&"libx264",!n&&"-crf",!n&&"23","-c:a","copy","-movflags","+faststart",`${b}/${y}_clip_${x}.${w}`].filter(Boolean),[4,u.exec(g,t)];case 1:return[2,i.sent()]}})})()})(n)];case 2:if(!(0!==(I=O.sent().status)&&n))return[3,4];return p(`HW Accel failed (Err ${I}). Retrying on CPU...`,"16px"),[4,E(!1)];case 3:I=O.sent().status,O.label=4;case 4:return 0===I?(h(c,!1),c.postMessage("clip-status-update",{id:f,status:"COMPLETED"}),p("Clip saved","18px")):(h(c,!1),c.postMessage("clip-status-update",{id:f,status:"ERROR"}),p(`Error: FFmpeg exited with code ${I}.`,"18px",!0,8e3)),[3,6];case 5:return C=O.sent(),h(c,!1),c.postMessage("clip-status-update",{id:f,status:"ERROR"}),p(`Exception: ${C}`,"18px",!0,8e3),[3,6];case 6:return[3,8];case 7:c.postMessage("clip-status-update",{id:f,status:"ERROR"}),p("Error: ffmpeg binary not found.","18px",!0,8e3),O.label=8;case 8:return[2]}})})()}(v.start,v.end,n,a,o,l,m,v.id)];case 3:y.sent(),y.label=4;case 4:return e=!0,[3,2];case 5:return[3,8];case 6:return b=y.sent(),c=!0,f=b,[3,8];case 7:try{e||null==d.return||d.return()}finally{if(c)throw f}return[7];case 8:return m.postMessage("batch-complete",{}),[2]}})})()}),m.onMessage("closeWindow",function(){m.hide()});var v=g.item("Start Clipping",function(){m.show(),f(m),d(m)},{keyBinding:"Alt+Shift+r"});g.addItem(v)}();
//# sourceMappingURL=index.js.map
